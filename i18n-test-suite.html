<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>51Talk Language Switching Test Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .test-result-pass { color: #10b981; }
        .test-result-fail { color: #ef4444; }
        .test-result-warning { color: #f59e0b; }
        .language-label { font-weight: bold; margin-right: 8px; }
        .progress-bar {
            transition: width 0.3s ease;
        }
        .test-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; }
        .translation-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            background: white;
        }
        .rtl {
            direction: rtl;
            text-align: right;
        }
        .test-header {
            background: linear-gradient(135deg, #26B7FF 0%, #3B82F6 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }
        @media (max-width: 768px) {
            .test-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="test-header">
            <h1 class="text-3xl font-bold mb-2">üöÄ 51Talk Language Switching Test Suite</h1>
            <p class="text-blue-100">Comprehensive validation of language switching across GradeUp, ScoreBoost, and SpeakUp</p>
        </div>

        <!-- Controls -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex flex-wrap gap-4 items-center justify-between">
                <div class="flex items-center gap-4">
                    <label class="font-semibold">Test Page:</label>
                    <select id="pageSelector" class="px-3 py-2 border rounded focus:ring-2 focus:ring-blue-500">
                        <option value="SpeakUp">SpeakUp</option>
                        <option value="GradeUp">GradeUp</option>
                        <option value="ScoreBoost">ScoreBoost</option>
                    </select>
                </div>

                <div class="flex items-center gap-4">
                    <label class="font-semibold">Test Language:</label>
                    <button onclick="runLangTest('zh')" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Chinese</button>
                    <button onclick="runLangTest('en')" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">English</button>
                    <button onclick="runLangTest('ar')" class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600">Arabic</button>
                </div>

                <button onclick="runComprehensiveTest()" class="px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 font-semibold">üß™ Run All Tests</button>
            </div>
        </div>

        <!-- Progress Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6 hidden" id="progressSection">
            <h3 class="font-bold text-lg mb-3">Test Progress</h3>
            <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
                <div id="testProgressBar" class="progress-bar bg-blue-500 h-3 rounded-full" style="width: 0%"></div>
            </div>
            <div class="flex justify-between text-sm text-gray-600">
                <span id="testCurrentStatus">Ready to start testing...</span>
                <span id="testProgressText">0/0 Complete</span>
            </div>
        </div>

        <!-- Test Statistics -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white rounded-lg shadow p-4">
                <div class="text-2xl font-bold text-blue-600" id="totalTests">0</div>
                <div class="text-gray-600">Total Tests</div>
            </div>
            <div class="bg-white rounded-lg shadow p-4">
                <div class="text-2xl font-bold text-green-600" id="passedTests">0</div>
                <div class="text-gray-600">Passed</div>
            </div>
            <div class="bg-white rounded-lg shadow p-4">
                <div class="text-2xl font-bold text-red-600" id="failedTests">0</div>
                <div class="text-gray-600">Failed</div>
            </div>
            <div class="bg-white rounded-lg shadow p-4">
                <div class="text-2xl font-bold text-yellow-600" id="warningTests">0</div>
                <div class="text-gray-600">Warnings</div>
            </div>
        </div>

        <!-- Test Results -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">üîç Real-time Test Results</h3>
                <button onclick="clearResults()" class="px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600">Clear</button>
            </div>
            <div id="testResults" class="max-h-64 overflow-y-auto space-y-2"></div>
        </div>

        <!-- Translation Validation -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">üìã Translation Validation Matrix</h3>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Chinese Translation -->
                <div class="border rounded-lg p-4">
                    <h4 class="font-semibold text-blue-600 mb-3">üá®üá≥ Chinese Translations</h4>
                    <div id="chineseTranslations" class="space-y-2 max-h-64 overflow-y-auto"></div>
                </div>

                <!-- English Translation -->
                <div class="border rounded-lg p-4">
                    <h4 class="font-semibold text-green-600 mb-3">üá¨üáß English Translations</h4>
                    <div id="englishTranslations" class="space-y-2 max-h-64 overflow-y-auto"></div>
                </div>

                <!-- Arabic Translation -->
                <div class="border rounded-lg p-4">
                    <h4 class="font-semibold text-purple-600 mb-3">üá∏üá¶ Arabic Translations</h4>
                    <div id="arabicTranslations" class="space-y-2 max-h-64 overflow-y-auto rtl"></div>
                </div>
            </div>
        </div>

        <!-- Detailed Test Report -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">üìä Detailed Test Report</h3>
            <div class="space-y-4" id="detailedReport">
                <p class="text-gray-600">Run tests to generate comprehensive report...</p>
            </div>
            <button onclick="exportReport()" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">üì§ Export Report</button>
        </div>

        <!-- Language Switching Demo -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-xl font-bold mb-4">üéÆ Interactive Language Switching Demo</h3>
            <div class="flex items-center gap-4 mb-4">
                <label class="font-semibold">Demo Language:</label>
                <div class="flex gap-2">
                    <button onclick="switchDemoLanguage('zh')" class="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600">Chinese</button>
                    <button onclick="switchDemoLanguage('en')" class="px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600">English</button>
                    <button onclick="switchDemoLanguage('ar')" class="px-3 py-1 bg-purple-500 text-white rounded text-sm hover:bg-purple-600">Arabic</button>
                </div>
            </div>
            <div id="demoContainer" class="bg-gray-100 p-4 rounded border">
                <p class="text-gray-600">Select a language to preview switching behavior...</p>
            </div>
        </div>
    </div>

    <script>
        // Test configuration and data
        const TEST_CONFIG = {
            pages: ['SpeakUp', 'GradeUp', 'ScoreBoost'],
            languages: ['zh', 'en', 'ar'],
            expectedTranslationsPerPage: 121
        };

        let testResults = [];
        let testProgress = 0;
        let totalTests = 0;

        // Mock data structures for testing
        const mockData = {
            SpeakUp: {
                translations: {
                    'meta.title': { zh: 'SpeakUp', en: 'SpeakUp', ar: 'SpeakUp' },
                    'hero.title': {
                        zh: 'ÈáçÂª∫Ëá™‰ø°ÔºåËÆ©Ëã±ËØ≠ÁúüÊ≠£ËØ¥Âá∫Êù•',
                        en: 'Rebuild confidence and truly speak English',
                        ar: 'ÿ•ÿπÿßÿØÿ© ÿ®ŸÜÿßÿ° ÿßŸÑÿ´ŸÇÿ© ‚Äî ŸÑÿ™ÿ™ŸÉŸÑŸëŸÖ ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ© ŸÅÿπŸÑŸäŸãÿß'
                    },
                    'hero.subtitle': {
                        zh: 'ÈòøÊãâ‰ºØËØ≠ÊïôÂ∏àÂºïÂØºÔºåÁî®ÊØçËØ≠ËÆ≤Ëß£ÂÆûÁî®ËØ≠Â¢ÉÔºå‰∏ÄÂØπ‰∏ÄÊÉÖÂ¢ÉÂåñËæÖÂØºÔºåËÆ©ÊØè‰∏ÄÊ¨°ÂºÄÂè£ÈÉΩÊõ¥Ëá™‰ø°„ÄÅÊõ¥Ëá™ÁÑ∂„ÄÇ',
                        en: 'Arabic-speaking teachers guide you, explaining practical contexts in your native language. One-on-one, contextual tutoring lets every time you speak be more confident and natural.',
                        ar: 'ŸÖÿπŸÑŸÖŸàŸÜ Ÿäÿ™ÿ≠ÿØÿ´ŸàŸÜ ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ŸäŸàÿ¨ŸëŸáŸàŸÜŸÉÿå Ÿäÿ¥ÿ±ÿ≠ŸàŸÜ ÿßŸÑÿ≥ŸäÿßŸÇÿßÿ™ ÿßŸÑÿπŸÖŸÑŸäÿ© ÿ®ŸÑÿ∫ÿ™ŸÉ ÿßŸÑÿ£ŸÖ. ÿ™ÿØÿ±Ÿäÿ® ŸÅÿ±ÿØŸä Ÿàÿßÿ≠ÿØ-ŸÑŸàÿßÿ≠ÿØ ŸÅŸä ÿ≥ŸäÿßŸÇ ÿ≠ŸÇŸäŸÇŸäÿå Ÿäÿ¨ÿπŸÑ ŸÉŸÑ ŸÖÿ±ÿ© ÿ™ÿ™ŸÉŸÑŸëŸÖ ŸÅŸäŸáÿß ÿ£ŸÉÿ´ÿ± ÿ´ŸÇÿ© Ÿàÿ£ŸÉÿ´ÿ± ÿ∑ÿ®ŸäÿπŸäÿ©.'
                    },
                    'footer.copyright': {
                        zh: '¬© 2024 51Talk. ‰øùÁïôÊâÄÊúâÊùÉÂà©„ÄÇ',
                        en: '¬© 2024 51Talk. All rights reserved.',
                        ar: '¬© 2024 51Talk. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©.'
                    }
                }
            }
        };

        // Initialize test suite
        function initTestSuite() {
            updateStatistics();

            // Add missing keys based on actual HTML data-i18n
            const allKeys = Array.from(new Set([
                ...Object.keys(mockData.SpeakUp.translations),
                'hero.cta_primary', 'hero.cta_secondary',
                'painpoints.title', 'painpoints.subtitle', 'painpoints.point1_title', 'painpoints.point1_desc',
                'painpoints.point1_tag', 'painpoints.point2_title', 'painpoints.point2_desc', 'painpoints.point2_tag',
                'painpoints.point3_title', 'painpoints.point3_desc', 'painpoints.point3_tag',
                'methodology.title', 'methodology.subtitle', 'methodology.method1_title', 'methodology.method1_desc',
                'methodology.method1_feature1', 'methodology.method1_feature2', 'methodology.method1_feature3',
                'methodology.method2_title', 'methodology.method2_desc', 'methodology.method2_feature1',
                'methodology.method2_feature2', 'methodology.method2_feature3', 'methodology.method3_title',
                'methodology.method3_desc', 'methodology.method3_feature1', 'methodology.method3_feature2',
                'methodology.method3_feature3', 'learning_path.title', 'learning_path.subtitle',
                'learning_path.step1_title', 'learning_path.step1_desc', 'learning_path.step2_title',
                'learning_path.step2_desc', 'learning_path.step3_title', 'learning_path.step3_desc',
                'learning_path.step4_title', 'learning_path.step4_desc', 'services.title', 'services.subtitle',
                'services.service1_title', 'services.service1_desc', 'services.service2_title', 'services.service2_desc',
                'services.service3_title', 'services.service3_desc', 'services.service4_title', 'services.service4_desc',
                'services.service5_title', 'services.service5_desc', 'services.service6_title', 'services.service6_desc',
                'services.cta_button', 'promotion.title', 'promotion.subtitle', 'promotion.original_price',
                'promotion.discount_price', 'promotion.savings', 'promotion.countdown_title', 'promotion.days_label',
                'promotion.hours_label', 'promotion.minutes_label', 'promotion.seconds_label', 'promotion.cta_button',
                'teachers.title', 'teachers.subtitle', 'teachers.teacher1_name', 'teachers.teacher1_title',
                'teachers.teacher2_name', 'teachers.teacher2_title', 'teachers.teacher3_name', 'teachers.teacher3_title',
                'teachers.teacher4_name', 'teachers.teacher4_title', 'teachers.badge_certified', 'teachers.badge_gold',
                'teachers.badge_senior', 'teachers.badge_young', 'courses.title', 'courses.subtitle',
                'courses.job_title', 'courses.job_subtitle', 'courses.job_desc', 'courses.job_duration',
                'courses.job_feature1', 'courses.job_feature2', 'courses.job_feature3', 'courses.job_button',
                'courses.work_title', 'courses.work_subtitle', 'courses.work_desc', 'courses.work_duration',
                'courses.work_feature1', 'courses.work_feature2', 'courses.work_feature3', 'courses.work_button',
                'courses.special_title', 'courses.special_subtitle', 'courses.special_desc', 'courses.special_duration',
                'courses.special_feature1', 'courses.special_feature2', 'courses.special_feature3', 'courses.special_button',
                'footer.company_name', 'footer.company_desc', 'footer.quick_links_title', 'footer.link_about',
                'footer.link_courses', 'footer.link_teachers', 'footer.contact_title', 'footer.contact_address',
                'footer.contact_phone', 'footer.contact_email', 'footer.social_title'
            ]));

            // Generate mock translations for all keys
            allKeys.forEach(key => {
                if (!mockData.SpeakUp.translations[key]) {
                    mockData.SpeakUp.translations[key] = {
                        zh: key.replace(/\./g, '¬∑') + ' (‰∏≠Êñá)',
                        en: key.replace(/\./g, '¬∑') + ' (English)',
                        ar: key.replace(/\./g, '¬∑') + ' (ÿßŸÑÿπÿ±ÿ®Ÿäÿ©)'
                    };
                }
            });
        }

        // Language switching test
        async function runLangTest(language) {
            const page = document.getElementById('pageSelector').value;
            showProgressSection();
            addTestResult(`Starting language test: ${language.toUpperCase()} for ${page}`, 'info');

            const results = await performLanguageTest(page, language);
            updateTestResults(results);

            addTestResult(`‚úÖ Language test completed: ${language.toUpperCase()} for ${page}`, 'pass');
            hideProgressSection();
        }

        // Comprehensive test
        async function runComprehensiveTest() {
            const page = document.getElementById('pageSelector').value;
            showProgressSection();
            testResults = [];

            addTestResult(`üöÄ Starting comprehensive test for ${page}...`, 'info');

            // Test each language
            for (let language of TEST_CONFIG.languages) {
                addTestResult(`Testing ${language.toUpperCase()}...`, 'info');
                const results = await performLanguageTest(page, language);
                updateTestResults(results);
                updateProgressBar(((TEST_CONFIG.languages.indexOf(language) + 1) / TEST_CONFIG.languages.length) * 100);
            }

            // Generate comprehensive report
            generateComprehensiveReport();

            addTestResult('‚úÖ All tests completed!', 'pass');
            hideProgressSection();
        }

        // Perform language test
        async function performLanguageTest(page, language) {
            const results = {
                language,
                page,
                translations: [],
                missingTranslations: [],
                incorrectTranslations: [],
                performance: [],
                summary: {}
            };

            try {
                // Mock language switching delay
                await sleep(500);

                // Test translations
                const translations = mockData[page]?.translations || {};
                const keys = Object.keys(translations);

                keys.forEach(key => {
                    const value = translations[key][language];

                    if (!value) {
                        results.missingTranslations.push({ key, language });
                    } else if (value === key || value === '') {
                        results.incorrectTranslations.push({ key, value, language });
                    } else {
                        results.translations.push({ key, value, language });
                    }
                });

                // Performance test
                const startTime = performance.now();

                // Simulate translation processing
                keys.forEach(key => {
                    const testElement = document.createElement('div');
                    testElement.setAttribute('data-i18n', key);
                    testElement.style.display = 'none';
                    document.body.appendChild(testElement);

                    // Simulate translation application
                    testElement.textContent = translations[key][language];
                    document.body.removeChild(testElement);
                });

                const endTime = performance.now();
                results.performance.push({
                    operation: 'language_switch',
                    duration: endTime - startTime,
                    keys_processed: keys.length
                });

                // RTL check for Arabic
                if (language === 'ar') {
                    const rtlCheck = testRtlSupport(results.translations.filter(t => t.language === 'ar'));
                    results.rtl_check = rtlCheck;
                }

                // Summary
                results.summary = {
                    totalKeys: keys.length,
                    translated: results.translations.length,
                    missing: results.missingTranslations.length,
                    incorrect: results.incorrectTranslations.length,
                    successRate: (results.translations.length / keys.length) * 100
                };

            } catch (error) {
                results.error = error.message;
            }

            return results;
        }

        // Test RTL support
        function testRtlSupport(arabicTranslations) {
            return arabicTranslations.every(translation => {
                const text = translation.value;
                // Basic RTL validation - check for Arabic characters
                const arabicPattern = /[\u0600-\u06FF]/;
                return arabicPattern.test(text);
            });
        }

        // Update test results display
        function updateTestResults(results) {
            testResults.push(results);

            // Add translation display
            updateTranslationDisplay(results);

            // Update statistics
            updateStatistics();

            // Add detailed results
            const resultClass = results.summary.successRate >= 95 ? 'test-result-pass' :
                               results.summary.successRate >= 80 ? 'test-result-warning' : 'test-result-fail';

            addTestResult(`üìù ${results.page} - ${results.language.toUpperCase()}: ${results.summary.translated}/${results.summary.totalKeys} translated (${results.summary.successRate.toFixed(1)}%)`, resultClass);

            if (results.missingTranslations.length > 0) {
                addTestResult(`‚ö†Ô∏è Missing ${results.missingTranslations.length} translations in ${results.language}`, 'warning');
            }

            if (results.incorrectTranslations.length > 0) {
                addTestResult(`‚ùå Found ${results.incorrectTranslations.length} incorrect translations in ${results.language}`, 'fail');
            }
        }

        // Update translation display
        function updateTranslationDisplay(results) {
            const container = results.language === 'ar' ? document.getElementById('arabicTranslations') :
                            results.language === 'en' ? document.getElementById('englishTranslations') :
                            document.getElementById('chineseTranslations');

            container.innerHTML = '';

            results.translations.forEach(translation => {
                const div = document.createElement('div');
                div.className = 'translation-card';
                div.innerHTML = `
                    <div class="font-mono text-sm text-gray-600">${translation.key}</div>
                    <div class="text-base ${results.language === 'ar' ? 'rtl' : ''}">${translation.value}</div>
                    <div class="text-xs text-gray-500 mt-1">Status: ‚úÖ Valid</div>
                `;
                container.appendChild(div);
            });

            // Show missing translations
            results.missingTranslations.forEach(missing => {
                const div = document.createElement('div');
                div.className = 'translation-card bg-red-50 border-red-200';
                div.innerHTML = `
                    <div class="font-mono text-sm text-red-600">${missing.key}</div>
                    <div class="text-base text-red-500">[MISSING TRANSLATION]</div>
                    <div class="text-xs text-red-500 mt-1">‚ö†Ô∏è Translation Not Found</div>
                `;
                container.appendChild(div);
            });
        }

        // Generate comprehensive report
        function generateComprehensiveReport() {
            const reportContainer = document.getElementById('detailedReport');

            if (testResults.length === 0) {
                reportContainer.innerHTML = '<p class="text-gray-600">No test results available.</p>';
                return;
            }

            const overallStats = calculateOverallStats();

            let reportHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h4 class="font-semibold text-green-800 mb-2">‚úÖ Overall Success Rate</h4>
                        <div class="text-2xl font-bold text-green-600">${overallStats.successRate.toFixed(1)}%</div>
                        <div class="text-green-600 text-sm">Average across all tests</div>
                    </div>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="font-semibold text-blue-800 mb-2">üìä Language Coverage</h4>
                        <div class="text-2xl font-bold text-blue-600">${overallStats.coverageRate.toFixed(1)}%</div>
                        <div class="text-blue-600 text-sm">Complete translation coverage</div>
                    </div>
                </div>

                <div class="space-y-6">
                    <h4 class="text-lg font-semibold">Language Performance Summary</h4>`;

            TEST_CONFIG.languages.forEach(lang => {
                const langResults = testResults.filter(r => r.language === lang);
                const langStats = calculateLanguageStats(langResults);

                reportHTML += `
                    <div class="border rounded-lg p-4 ${lang === 'ar' ? 'rtl' : ''}">
                        <h5 class="font-semibold mb-3">${lang === 'zh' ? 'üá®üá≥ Chinese' : lang === 'en' ? 'üá¨üáß English' : 'üá∏üá¶ Arabic'}</h5>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div class="text-center">
                                <div class="font-bold text-green-600">${langStats.translated}</div>
                                <div class="text-gray-600">Translated</div>
                            </div>
                            <div class="text-center">
                                <div class="font-bold text-red-600">${langStats.missing}</div>
                                <div class="text-gray-600">Missing</div>
                            </div>
                            <div class="text-center">
                                <div class="font-bold">${langStats.successRate.toFixed(1)}%</div>
                                <div class="text-gray-600">Success Rate</div>
                            </div>
                            <div class="text-center">
                                <div class="font-bold">${langStats.avgPerformance}ms</div>
                                <div class="text-gray-600">Avg Speed</div>
                            </div>
                        </div>
                    </div>`;
            });

            // Issues summary
            const totalMissing = testResults.reduce((sum, r) => sum + r.missingTranslations.length, 0);
            const totalIncorrect = testResults.reduce((sum, r) => sum + r.incorrectTranslations.length, 0);

            if (totalMissing > 0 || totalIncorrect > 0) {
                reportHTML += `
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <h5 class="font-semibold text-yellow-800 mb-3">‚ö†Ô∏è Issues Found</h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <div class="font-bold text-red-600">${totalMissing} Missing</div>
                                <div class="text-gray-600 text-sm">Translation keys without values</div>
                            </div>
                            <div>
                                <div class="font-bold text-orange-600">${totalIncorrect} Incorrect</div>
                                <div class="text-gray-600 text-sm">Validations that need attention</div>
                            </div>
                        </div>
                    </div>`;
            }

            reportHTML += '</div>';
            reportContainer.innerHTML = reportHTML;
        }

        // Statistical functions
        function calculateOverallStats() {
            const totalTranslations = testResults.reduce((sum, r) => sum + r.summary.totalKeys, 0);
            const successfulTranslations = testResults.reduce((sum, r) => sum + r.summary.translated, 0);

            return {
                successRate: (successfulTranslations / totalTranslations) * 100 || 0,
                coverageRate: testResults.length > 0 ?
                    (testResults.filter(r => r.summary.successRate >= 95).length / testResults.length) * 100 : 0,
                totalTests: testResults.length
            };
        }

        function calculateLanguageStats(languageResults) {
            const translated = languageResults.reduce((sum, r) => sum + r.summary.translated, 0);
            const missing = languageResults.reduce((sum, r) => sum + r.summary.missing, 0);
            const total = translated + missing;
            const avgPerformance = languageResults.length > 0 ?
                languageResults.reduce((sum, r) => sum + (r.performance[0]?.duration || 0), 0) / languageResults.length : 0;

            return {
                translated,
                missing,
                total,
                successRate: total > 0 ? (translated / total) * 100 : 0,
                avgPerformance: Math.round(avgPerformance)
            };
        }

        // Helper functions
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function showProgressSection() {
            document.getElementById('progressSection').classList.remove('hidden');
            updateProgressBar(0);
        }

        function hideProgressSection() {
            setTimeout(() => {
                document.getElementById('progressSection').classList.add('hidden');
            }, 1000);
        }

        function updateProgressBar(percentage) {
            document.getElementById('testProgressBar').style.width = percentage + '%';
            document.getElementById('testCurrentStatus').textContent =
                percentage === 100 ? 'Testing complete!' : `Testing... ${Math.round(percentage)}%`;
        }

        function addTestResult(message, type = 'info') {
            const resultsContainer = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `p-2 rounded border-l-4 ${getResultTypeClass(type)}`;
            resultDiv.innerHTML = `
                <div class="flex items-center gap-2">
                    <span class="text-sm font-mono text-gray-500">[${new Date().toLocaleTimeString()}]</span>
                    <span class="flex-1">${message}</span>
                </div>
            `;
            resultsContainer.insertBefore(resultDiv, resultsContainer.firstChild);
        }

        function getResultTypeClass(type) {
            switch (type) {
                case 'pass': return 'border-green-400 bg-green-50';
                case 'fail': return 'border-red-400 bg-red-50';
                case 'warning': return 'border-yellow-400 bg-yellow-50';
                default: return 'border-blue-400 bg-blue-50';
            }
        }

        function updateStatistics() {
            const passCount = testResults.filter(r => r.summary?.successRate >= 95).length;
            const failCount = testResults.filter(r => r.summary?.successRate < 80).length;
            const warningCount = testResults.filter(r =>
                r.summary?.successRate >= 80 && r.summary?.successRate < 95
            ).length;

            document.getElementById('totalTests').textContent = testResults.length;
            document.getElementById('passedTests').textContent = passCount;
            document.getElementById('failedTests').textContent = failCount;
            document.getElementById('warningTests').textContent = warningCount;
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('chineseTranslations').innerHTML = '';
            document.getElementById('englishTranslations').innerHTML = '';
            document.getElementById('arabicTranslations').innerHTML = '';
            document.getElementById('detailedReport').innerHTML = '<p class="text-gray-600">Run tests to generate comprehensive report...</p>';
            testResults = [];
            updateStatistics();
        }

        // Demo functions
        function switchDemoLanguage(language) {
            const demoContainer = document.getElementById('demoContainer');
            const translations = mockData.SpeakUp.translations;

            if (!translations) {
                demoContainer.innerHTML = '<p class="text-gray-600">No demo data available.</p>';
                return;
            }

            demoContainer.className = `bg-gray-100 p-4 rounded border ${language === 'ar' ? 'rtl' : ''}`;

            let demoHTML = `
                <div class="space-y-3">
                    <div><strong>Meta Title:</strong> ${translations['meta.title'][language]}</div>
                    <div><strong>Hero Title:</strong> ${translations['hero.title'][language]}</div>
                    <div><strong>Hero Subtitle:</strong> ${translations['hero.subtitle'][language]}</div>
                    <div><strong>CTA Primary:</strong> ${translations['footer.copyright'][language]}</div>
                </div>
            `;

            demoContainer.innerHTML = demoHTML;
            addTestResult(`üéÆ Demo language switched to ${language.toUpperCase()}`, 'info');
        }

        function exportReport() {
            const report = {
                timestamp: new Date().toISOString(),
                totalTests: testResults.length,
                config: TEST_CONFIG,
                results: testResults,
                overallStats: calculateOverallStats()
            };

            const dataStr = JSON.stringify(report, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `i18n-validation-report-${Date.now()}.json`;
            link.click();

            addTestResult('üì§ Report exported successfully', 'pass');
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initTestSuite();
            addTestResult('üéØ Test suite initialized and ready', 'info');
        });
    </script>
</body>
</html>